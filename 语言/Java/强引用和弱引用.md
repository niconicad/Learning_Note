### **å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰ä¸å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰çš„æœ¬è´¨åŒºåˆ«**

åœ¨ Java ä¸­ï¼Œå¯¹è±¡çš„å¼•ç”¨ç±»å‹å†³å®šäº† **åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å¦‚ä½•å¤„ç†å¯¹è±¡**ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«å’Œå®é™…åº”ç”¨åœºæ™¯ï¼š

------

## **1. å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰**

### **å®šä¹‰**

- **é»˜è®¤çš„å¼•ç”¨ç±»å‹**ï¼Œåªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œå¯¹è±¡æ°¸è¿œä¸ä¼šè¢« GC å›æ”¶ã€‚
- ä¾‹å¦‚ï¼š`Object obj = new Object();` ä¸­çš„ `obj` å°±æ˜¯å¼ºå¼•ç”¨ã€‚

### **ç‰¹ç‚¹**

1. **å¯¹è±¡å­˜æ´»æ¡ä»¶**ï¼šåªè¦å¼ºå¼•ç”¨å¯è¾¾ï¼Œå³ä½¿å†…å­˜ä¸è¶³ï¼ˆOOMï¼‰ï¼ŒGC ä¹Ÿä¸ä¼šå›æ”¶è¯¥å¯¹è±¡ã€‚
2. **ç”Ÿå‘½å‘¨æœŸæ§åˆ¶**ï¼šæ‰‹åŠ¨å°†å¼•ç”¨èµ‹å€¼ä¸º `null`ï¼ˆ`obj = null`ï¼‰æ—¶ï¼Œå¯¹è±¡æ‰ä¼šè¢«æ ‡è®°ä¸ºå¯å›æ”¶ã€‚

### **ä»£ç ç¤ºä¾‹**

java

å¤åˆ¶

```java
public class StrongReferenceDemo {
    public static void main(String[] args) {
        Object obj = new Object();  // å¼ºå¼•ç”¨
        System.gc();                // è§¦å‘GC
        System.out.println(obj);    // å¯¹è±¡ä¾ç„¶å­˜åœ¨ï¼Œè¾“å‡º: java.lang.Object@xxxxxx
        
        obj = null;                 // æ–­å¼€å¼ºå¼•ç”¨
        System.gc();                // å†æ¬¡è§¦å‘GC
        System.out.println(obj);    // è¾“å‡º: null
    }
}
```

### **åº”ç”¨åœºæ™¯**

- æ™®é€šå¯¹è±¡çš„æ­£å¸¸ä½¿ç”¨ï¼ˆå¦‚é›†åˆã€ä¸šåŠ¡ç±»å®ä¾‹ï¼‰ã€‚

------

## **2. å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰**

### **å®šä¹‰**

- é€šè¿‡ `java.lang.ref.WeakReference` ç±»å®ç°ï¼Œ**åªè¦å‘ç”Ÿ GCï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œå¼±å¼•ç”¨å¯¹è±¡éƒ½ä¼šè¢«å›æ”¶**ã€‚
- ä¾‹å¦‚ï¼š`WeakReference<Object> weakRef = new WeakReference<>(new Object());`ã€‚

### **ç‰¹ç‚¹**

1. **GC æ•æ„Ÿ**ï¼šä¸€æ—¦ GC è¿è¡Œï¼Œå¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ä¼šè¢«ç«‹å³å›æ”¶ã€‚
2. **å¿…é¡»é…åˆå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰ä½¿ç”¨**ï¼šç”¨äºè·Ÿè¸ªè¢«å›æ”¶çš„å¼±å¼•ç”¨ã€‚

### **ä»£ç ç¤ºä¾‹**

java

å¤åˆ¶

```java
import java.lang.ref.WeakReference;

public class WeakReferenceDemo {
    public static void main(String[] args) {
        WeakReference<Object> weakRef = new WeakReference<>(new Object());
        System.out.println(weakRef.get());  // è¾“å‡º: java.lang.Object@xxxxxx
        
        System.gc();                        // è§¦å‘GC
        System.out.println(weakRef.get());  // è¾“å‡º: nullï¼ˆå¯¹è±¡å·²è¢«å›æ”¶ï¼‰
    }
}
```

### **åº”ç”¨åœºæ™¯**

1. **ç¼“å­˜è®¾è®¡**ï¼ˆå¦‚ `WeakHashMap`ï¼ŒKey è¢«å›æ”¶åè‡ªåŠ¨ç§»é™¤æ¡ç›®ï¼‰ã€‚
2. **é˜²æ­¢å†…å­˜æ³„æ¼**ï¼ˆå¦‚ `ThreadLocal` ä¸­çš„ Key ä½¿ç”¨å¼±å¼•ç”¨é¿å…å †ç§¯ï¼‰ã€‚

------

## **3. å¯¹æ¯”æ€»ç»“**

| **ç‰¹æ€§**         | **å¼ºå¼•ç”¨**                    | **å¼±å¼•ç”¨**                       |
| ---------------- | ----------------------------- | -------------------------------- |
| **GC è¡Œä¸º**      | ä¸å›æ”¶ï¼ˆé™¤éæ˜¾å¼ç½®ä¸º `null`ï¼‰ | ä¸‹æ¬¡ GC ç«‹å³å›æ”¶                 |
| **å†…å­˜æ³„æ¼é£é™©** | é«˜ï¼ˆéœ€æ‰‹åŠ¨ç®¡ç†ï¼‰              | ä½ï¼ˆè‡ªåŠ¨å›æ”¶ï¼‰                   |
| **å…¸å‹ç”¨é€”**     | æ™®é€šå¯¹è±¡                      | ç¼“å­˜ã€ç›‘å¬å™¨ã€ThreadLocal çš„ Key |

------

## **4. å…¶ä»–å¼•ç”¨ç±»å‹**

### **4.1 è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰**

- **ç‰¹ç‚¹**ï¼šå†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢« GC å›æ”¶ï¼ˆé€‚åˆå®ç°å†…å­˜æ•æ„Ÿçš„ç¼“å­˜ï¼‰ã€‚

- 

  ç¤ºä¾‹

  ï¼š

  java

  å¤åˆ¶

  ```java
  SoftReference<byte[]> softRef = new SoftReference<>(new byte[1024 * 1024]);
  ```

### **4.2 è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰**

- **ç‰¹ç‚¹**ï¼šæ— æ³•é€šè¿‡è™šå¼•ç”¨è·å–å¯¹è±¡ï¼Œä»…ç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«å›æ”¶çš„é€šçŸ¥ï¼ˆå¿…é¡»é…åˆ `ReferenceQueue`ï¼‰ã€‚

- 

  ç¤ºä¾‹

  ï¼š

  java

  å¤åˆ¶

  ```java
  ReferenceQueue<Object> queue = new ReferenceQueue<>();
  PhantomReference<Object> phantomRef = new PhantomReference<>(new Object(), queue);
  ```

------

## **5. å®æˆ˜å»ºè®®**

1. **å¼ºå¼•ç”¨**ï¼šé»˜è®¤é€‰æ‹©ï¼Œä½†éœ€æ³¨æ„æ‰‹åŠ¨é‡Šæ”¾ï¼ˆå¦‚å…³é—­æ•°æ®åº“è¿æ¥ï¼‰ã€‚
2. **å¼±å¼•ç”¨/è½¯å¼•ç”¨**ï¼šç¼“å­˜åœºæ™¯ä¼˜å…ˆç”¨ `SoftReference`ï¼Œ`ThreadLocal` ç”¨ `WeakReference`ã€‚
3. **è™šå¼•ç”¨**ï¼šä»…ç”¨äºç‰¹æ®Šèµ„æºæ¸…ç†ï¼ˆå¦‚å †å¤–å†…å­˜ç®¡ç†ï¼‰ã€‚

é€šè¿‡åˆç†é€‰æ‹©å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥æ˜¾è‘—ä¼˜åŒ–å†…å­˜ç®¡ç†å’Œé¿å…æ³„æ¼ï¼ ğŸš€